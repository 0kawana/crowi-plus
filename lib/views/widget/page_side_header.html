{% if page %} {# {{{ if page #}
<div class="page-meta">
  <div class="row">
    {# default(author) としているのは、v1.1.1 以前に page.creator データが入ってないから。暫定として最新更新ユーザーを表示しちゃう。 #}
    <div class="col-md-3 creator-picture">
      <img src="{{ page.creator|default(author)|picture }}" class="picture picture-lg picture-rounded"><br>
    </div>
    <div class="col-md-9">
      <p class="creator">
        {{ page.creator.name|default(author.name) }}
      </p>
      <p class="created-at">
        作成日: {{ page.createdAt|datetz('Y/m/d H:i:s') }}<br>
        最終更新: {{ page.updatedAt|datetz('Y/m/d H:i:s') }} <a href="/user/{{ page.revision.author.username }}"><img src="{{ page.revision.author|picture }}" class="picture picture-xs picture-rounded" alt="{{ page.revision.author.name }}"></a>
      </p>
    </div>
  </div>

  <div class="like-box">
    <dl class="dl-horizontal">
      <dt>
        <i class="fa fa-thumbs-o-up"></i> いいね!
      </dt>
      <dd>
        <p class="liker-count">
        {{ page.liker.length }}
          {% if page.isLiked(user) %}
            <button data-liked="1" class="btn btn-default btn-sm active" id="pageLikeButton"><i class="fa fa-thumbs-up"></i> いいね！</button>
          {% else %}
            <button data-liked="0" class="btn btn-default btn-sm" id="pageLikeButton"><i class="fa fa-thumbs-o-up"></i> いいね！</button>
          {% endif %}
        </p>
        <p class="liker-list">
          {% for liker in page.liker %}
            <a href="{{ user_page_root(liker) }}" title="{{ liker.name }}"><img alt="{{ liker.name }}" src="{{ liker|picture }}" class="picture picture-xs picture-rounded"></a>
          {% endfor %}
          {% if page.liker.length > 10 %}
            (...)
          {% endif %}
        </p>
      </dd>

      <dt><i class="fa fa-eye"></i> 見た人</dt>
      <dd>
        <p class="seen-user-count">
          {{ page.seenUsers.length }}
        </p>
        <p class="seen-user-list">
          {% for seenUser in page.seenUsers %}
          <a href="{{ user_page_root(seenUser) }}" title="{{ seenUser.name }}"><img alt="{{ seenUser.name }}" src="{{ seenUser|picture }}" class="picture picture-xs picture-rounded"></a>
          {% endfor %}
          {% if page.seenUsers.length > 10 %}
            (...)
          {% endif %}
        </p>
      </dd>
    </dl>
  </div>
<script>
$(function() {
  $('#pageLikeButton').click(function() {
    var pageId = {{page._id|json|safe}};
    $.post('/_api/page/{{ page._id.toString() }}/like', function(data) {
    });
  });
});
</script>
</div>
{% endif %} {# if page }}} #}
